<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="theme-color" content="#ff6f61">
  <title> üìí Meus Lembretes</title>
  <style>
    /* ... mesmo CSS do exemplo anterior ... */
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    body {
      background: linear-gradient(135deg, #ff9ec6, #a1e4ff, #fff176);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
      border: 4px solid #ffb3ba;
    }
    h1 {
      text-align: center;
      color: #d81b60;
      margin-bottom: 20px;
      font-size: 28px;
    }
    .input-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 16px;
    }
    label {
      font-weight: bold;
      color: #555;
      font-size: 14px;
    }
    input, textarea, select {
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 10px;
      font-size: 16px;
    }
    textarea { resize: vertical; min-height: 60px; }
    .row {
      display: flex;
      gap: 12px;
    }
    .row > .input-group { flex: 1; }
    button {
      background: #ff6f61;
      color: white;
      border: none;
      padding: 12px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s;
      font-size: 16px;
      margin-top: 8px;
    }
    button:hover { background: #ff4b3a; }
    .reminders-list {
      list-style: none;
      margin-top: 24px;
    }
    .reminder-item {
      background: #fdf6f0;
      padding: 16px;
      border-radius: 12px;
      margin-bottom: 14px;
      border-left: 5px solid #ff6f61;
    }
    .reminder-item.completed {
      opacity: 0.8;
      border-left-color: #4caf50;
    }
    .reminder-item.completed .reminder-title {
      text-decoration: line-through;
      color: #777;
    }
    .reminder-title {
      font-weight: bold;
      font-size: 18px;
      color: #d81b60;
    }
    .reminder-meta {
      font-size: 13px;
      color: #555;
      margin: 6px 0;
    }
    .reminder-text {
      color: #444;
      margin-top: 6px;
      font-size: 15px;
    }
    .reminder-actions {
      margin-top: 12px;
      display: flex;
      gap: 10px;
    }
    .btn-done { background: #4caf50; }
    .btn-delete { background: #f44336; }
    .recurrence-badge {
      display: inline-block;
      background: #e3f2fd;
      color: #1976d2;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
      margin-left: 6px;
    }
    .notification-tip {
      text-align: center;
      margin-top: 10px;
      font-size: 14px;
      color: #d81b60;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1> Meus Lembretes Di√°rios ‚úÖ</h1>

    <div class="input-group">
      <label for="title">T√≠tulo *</label>
      <input type="text" id="title" placeholder="Ex: medicos e atividades" />
    </div>

    <div class="input-group">
      <label for="description">Descri√ß√£o</label>
      <textarea id="description" placeholder="Detalhes do lembrete..."></textarea>
    </div>

    <div class="row">
      <div class="input-group">
        <label for="date">Data</label>
        <input type="date" id="date" />
      </div>
      <div class="input-group">
        <label for="time">Hora</label>
        <input type="time" id="time" />
      </div>
    </div>

    <div class="input-group">
      <label for="recurrence">Lembrete recorrente?</label>
      <select id="recurrence">
        <option value="">Nenhum</option>
        <option value="daily">Diariamente</option>
        <option value="weekly">Semanalmente</option>
        <option value="monthly">Mensalmente</option>
      </select>
    </div>

    <button id="add-btn">‚úÖ Adicionar Lembrete</button>
    <div class="notification-tip">üîîüîî Voc√™ receber√° notifica√ß√µes com som no celular!</div>

    <ul class="reminders-list" id="reminders-list"></ul>
  </div>

  <!-- √Åudio oculto para notifica√ß√£o -->
  <audio id="notification-sound" preload="auto">
    <source src="https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3" type="audio/mpeg">
  </audio>

  <script>
    const titleInput = document.getElementById('title');
    const descInput = document.getElementById('description');
    const dateInput = document.getElementById('date');
    const timeInput = document.getElementById('time');
    const recurrenceSelect = document.getElementById('recurrence');
    const addBtn = document.getElementById('add-btn');
    const listEl = document.getElementById('reminders-list');
    const audio = document.getElementById('notification-sound');

    let reminders = JSON.parse(localStorage.getItem('reminders')) || [];
    let userHasInteracted = false; // Para destravar o som

    // Marca que o usu√°rio interagiu (permite tocar √°udio)
    function markInteraction() {
      userHasInteracted = true;
    }

    // Solicita permiss√£o para notifica√ß√µes
    function requestNotificationPermission() {
      if (window.Notification && Notification.permission === 'default') {
        Notification.requestPermission();
      }
    }

    function saveReminders() {
      localStorage.setItem('reminders', JSON.stringify(reminders));
    }

    function formatDate(dateStr) {
      if (!dateStr) return '';
      const d = new Date(dateStr);
      return d.toLocaleDateString('pt-BR');
    }

    function formatRecurrence(rec) {
      const map = {
        daily: 'üîÅ Di√°rio',
        weekly: 'üîÅ Semanal',
        monthly: 'üîÅ Mensal'
      };
      return map[rec] || '';
    }

    // Toca notifica√ß√£o com som (se poss√≠vel)
    function showNotificationWithSound(title, body) {
      // Notifica√ß√£o visual
      if (window.Notification && Notification.permission === 'granted') {
        new Notification('üìå Lembrete!', {
          body: body,
          icon: 'https://cdn-icons-png.flaticon.com/512/2526/2526240.png'
        });
      }

      // Tocar som (s√≥ se o usu√°rio j√° interagiu)
      if (userHasInteracted && audio) {
        audio.currentTime = 0;
        audio.play().catch(e => console.log("√Åudio bloqueado:", e));
      }
    }

    function checkDueReminders() {
      const now = new Date();
      const nowDate = now.toISOString().split('T')[0]; // YYYY-MM-DD
      const nowTime = now.toTimeString().substring(0, 5); // HH:MM

      reminders.forEach((reminder, index) => {
        if (reminder.done) return;

        if (reminder.date && reminder.time && reminder.date === nowDate && reminder.time === nowTime) {
          showNotificationWithSound(
            reminder.title,
            reminder.description || 'Hora do lembrete! N√£o esque√ßa! üòä'
          );
          reminders[index].done = true; // evita repetir
          saveReminders();
          renderReminders();
        }
      });
    }

    setInterval(checkDueReminders, 60000);

    function renderReminders() {
      listEl.innerHTML = '';
      reminders.forEach((reminder, index) => {
        const li = document.createElement('li');
        li.className = `reminder-item ${reminder.done ? 'completed' : ''}`;

        let meta = '';
        if (reminder.date || reminder.time) {
          meta = `${reminder.date ? formatDate(reminder.date) : ''}${reminder.time ? ' √†s ' + reminder.time : ''}`;
        }

        const recurrenceText = formatRecurrence(reminder.recurrence);

        li.innerHTML = `
          <div class="reminder-title">
            ${reminder.title}
            ${recurrenceText ? `<span class="recurrence-badge">${recurrenceText}</span>` : ''}
          </div>
          ${meta ? `<div class="reminder-meta">üìÜ ${meta}</div>` : ''}
          ${reminder.description ? `<div class="reminder-text">${reminder.description}</div>` : ''}
          <div class="reminder-actions">
            <button class="btn-done" onclick="toggleDone(${index})">
              ${reminder.done ? '‚ùå Desfazer' : '‚úÖ Conclu√≠do'}
            </button>
            <button class="btn-delete" onclick="deleteReminder(${index})">üóëÔ∏è Excluir</button>
          </div>
        `;
        listEl.appendChild(li);
      });
    }

    function addReminder() {
      markInteraction(); // Libera o som
      const title = titleInput.value.trim();
      if (!title) {
        alert('‚ö†Ô∏è Por favor, digite um t√≠tulo!');
        return;
      }

      const newReminder = {
        title,
        description: descInput.value.trim(),
        date: dateInput.value || null,
        time: timeInput.value || null,
        recurrence: recurrenceSelect.value || null,
        done: false
      };

      if (newReminder.time && !newReminder.date) {
        alert('‚ö†Ô∏è Defina uma data se estiver usando hora.');
        return;
      }

      reminders.push(newReminder);
      saveReminders();
      renderReminders();

      // Limpar
      titleInput.value = '';
      descInput.value = '';
      dateInput.value = '';
      timeInput.value = '';
      recurrenceSelect.value = '';
      titleInput.focus();
    }

    window.toggleDone = function(index) {
      markInteraction();
      reminders[index].done = !reminders[index].done;
      saveReminders();
      renderReminders();
    };

    window.deleteReminder = function(index) {
      markInteraction();
      if (confirm('‚ùì Excluir este lembrete?')) {
        reminders.splice(index, 1);
        saveReminders();
        renderReminders();
      }
    };

    addBtn.addEventListener('click', () => {
      markInteraction();
      requestNotificationPermission();
      addReminder();
    });

    titleInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        markInteraction();
        requestNotificationPermission();
        addReminder();
      }
    });

    const today = new Date().toISOString().split('T')[0];
    dateInput.value = today;

    renderReminders();
    requestNotificationPermission();
  </script>
</body>
</html>